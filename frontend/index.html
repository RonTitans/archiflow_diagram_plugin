<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArchiFlow Network Diagram Manager</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <h1 class="logo">ArchiFlow</h1>
            <div class="site-selector">
                <select id="siteSelector" class="site-dropdown">
                    <option value="">Select a site...</option>
                </select>
            </div>
        </div>
        <div class="header-right">
            <div id="connectionStatus" class="connection-status">
                <span class="status-dot disconnected"></span>
                <span class="status-text">Disconnected</span>
            </div>
            <button id="createDiagramBtn" class="btn btn-primary">
                <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                    <path d="M8 2V14M2 8H14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                New Diagram
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-container">
        <!-- Sidebar with Diagram List -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>Diagrams</h2>
                <div class="diagram-stats">
                    <span id="diagramCount">0 diagrams</span>
                </div>
            </div>

            <!-- Search/Filter -->
            <div class="sidebar-controls">
                <input type="text" id="searchDiagrams" class="search-input" placeholder="Search diagrams...">
                <select id="filterStatus" class="filter-dropdown">
                    <option value="all">All Status</option>
                    <option value="deployed">Deployed</option>
                    <option value="draft">Drafts</option>
                </select>
            </div>

            <!-- Diagram List -->
            <div id="diagramList" class="diagram-list">
                <!-- Diagrams will be populated here -->
            </div>
        </div>

        <!-- Network Device Palette -->
        <div id="devicePalette" class="device-palette" style="display: none;">
            <div class="palette-header">
                <h3>Network Devices</h3>
                <button id="closePaletteBtn" class="btn-icon-small" title="Close">
                    <svg width="16" height="16" viewBox="0 0 16 16">
                        <path d="M4 4L12 12M12 4L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>

            <div class="palette-tabs">
                <button class="palette-tab active" data-view="templates">Templates</button>
                <button class="palette-tab" data-view="configured">Configured (<span id="configuredDeviceCount">0</span>)</button>
            </div>

            <!-- Templates View -->
            <div id="templatesView" class="palette-view">
                <div class="palette-search">
                    <input type="text" id="deviceSearch" placeholder="Search templates..." class="search-input">
                </div>

                <div id="deviceTemplateList" class="device-template-list">
                    <!-- Device templates will be loaded here -->
                </div>
            </div>

            <!-- Configured Devices View -->
            <div id="configuredView" class="palette-view" style="display: none;">
                <div style="padding: 12px; background: #f0f8ff; border-bottom: 1px solid #ddd; font-size: 12px;">
                    <strong>ðŸ“‹ Configured Devices</strong><br>
                    Devices are ready to deploy to database.
                </div>
                <div id="configuredDeviceList" class="device-template-list">
                    <!-- Configured devices will appear here -->
                </div>
            </div>

            <div class="palette-footer">
                <button id="manageDevicesBtn" class="btn btn-small btn-secondary">
                    <svg class="icon" width="14" height="14" viewBox="0 0 16 16">
                        <circle cx="8" cy="4" r="2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                        <circle cx="8" cy="12" r="2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                        <path d="M8 6V10" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    Manage Devices
                </button>
            </div>
        </div>

        <!-- Editor Area -->
        <div class="editor-container">
            <div id="welcomeMessage" class="welcome-message">
                <div class="welcome-content">
                    <svg class="welcome-icon" width="64" height="64" viewBox="0 0 24 24" fill="none">
                        <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 17L12 22L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M2 12L12 17L22 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <h2>Welcome to ArchiFlow</h2>
                    <p>Select a site and choose a diagram to begin editing</p>
                    <button id="createFirstDiagram" class="btn btn-primary btn-large">Create Your First Diagram</button>
                </div>
            </div>

            <!-- Editor Toolbar (hidden by default) -->
            <div id="editorToolbar" class="editor-toolbar" style="display: none;">
                <div class="toolbar-left">
                    <h3 id="currentDiagramTitle">Untitled Diagram</h3>
                    <span id="currentDiagramStatus" class="status-badge draft">Draft</span>
                </div>
                <div class="toolbar-right">
                    <button id="addDeviceBtn" class="btn btn-primary" title="Add Network Device" style="margin-right: 8px;">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="margin-right: 4px;">
                            <path d="M8 2V14M2 8H14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        Add Device
                    </button>
                    <button id="toggleDevicePaletteBtn" class="btn btn-icon" title="Configured Devices">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <rect x="3" y="4" width="6" height="5" stroke="currentColor" stroke-width="1.5" rx="1"/>
                            <rect x="11" y="4" width="6" height="5" stroke="currentColor" stroke-width="1.5" rx="1"/>
                            <rect x="3" y="11" width="6" height="5" stroke="currentColor" stroke-width="1.5" rx="1"/>
                            <rect x="11" y="11" width="6" height="5" stroke="currentColor" stroke-width="1.5" rx="1"/>
                        </svg>
                    </button>
                    <button id="saveBtn" class="btn btn-icon" title="Save">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M17 6L11 12L8 9L2 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                    <button id="deployBtn" class="btn btn-success" title="Deploy">
                        <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                            <path d="M8 1V11M8 11L12 7M8 11L4 7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        Deploy
                    </button>
                    <button id="moreOptionsBtn" class="btn btn-icon" title="More Options">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <circle cx="10" cy="10" r="1" fill="currentColor"/>
                            <circle cx="10" cy="4" r="1" fill="currentColor"/>
                            <circle cx="10" cy="16" r="1" fill="currentColor"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Draw.io Editor with Plugin Loader -->
            <iframe id="drawioEditor" class="drawio-editor" src="plugin-loader.html" style="display: none;"></iframe>
        </div>
    </div>

    <!-- Create Diagram Modal -->
    <div id="createDiagramModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New Diagram</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Diagram Name</label>
                    <input type="text" id="newDiagramName" placeholder="e.g., Main Network Topology" autofocus>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="newDiagramDescription" placeholder="Describe the purpose of this diagram..." rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Site</label>
                    <select id="newDiagramSite" class="form-select">
                        <option value="">Select site...</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel">Cancel</button>
                <button id="confirmCreateBtn" class="btn btn-primary">Create Diagram</button>
            </div>
        </div>
    </div>

    <!-- Device Configuration Modal -->
    <div id="deviceConfigModal" class="modal">
        <div class="modal-content device-property-editor">
            <div class="modal-header">
                <h2>Configure Network Device</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Device Name *</label>
                    <input type="text" id="deviceName" placeholder="e.g., Core-Switch-01" required>
                </div>

                <div class="property-grid">
                    <div class="form-group">
                        <label>Device Type</label>
                        <input type="text" id="deviceTypeDisplay" readonly style="background: #f5f5f5;">
                    </div>
                    <div class="form-group">
                        <label>Status</label>
                        <select id="deviceStatus">
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                            <option value="maintenance">Maintenance</option>
                        </select>
                    </div>
                </div>

                <div class="property-grid">
                    <div class="form-group">
                        <label>Manufacturer</label>
                        <input type="text" id="deviceManufacturer" placeholder="e.g., Cisco">
                    </div>
                    <div class="form-group">
                        <label>Model</label>
                        <input type="text" id="deviceModel" placeholder="e.g., Catalyst 9300">
                    </div>
                </div>

                <div class="property-grid">
                    <div class="form-group">
                        <label>Asset ID</label>
                        <input type="text" id="deviceAssetId" placeholder="e.g., AST-001234">
                    </div>
                    <div class="form-group">
                        <label>Serial Number</label>
                        <input type="text" id="deviceSerialNumber" placeholder="e.g., SN123456">
                    </div>
                </div>

                <div class="property-grid">
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" id="deviceLocation" placeholder="e.g., Rack A1">
                    </div>
                    <div class="form-group">
                        <label>Rack Position</label>
                        <input type="text" id="deviceRackPosition" placeholder="e.g., U10-U12">
                    </div>
                </div>

                <div class="form-group" style="margin-top: 20px;">
                    <label style="display: flex; justify-content: space-between; align-items: center;">
                        <span>IP Addresses</span>
                        <button type="button" id="addIpBtn" class="btn btn-small btn-primary">+ Add IP</button>
                    </label>
                    <div id="ipAllocationsList" class="ip-allocation-list" style="min-height: 60px;">
                        <div style="text-align: center; padding: 20px; color: #999;">
                            No IP addresses allocated
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel">Cancel</button>
                <button id="saveDeviceConfigBtn" class="btn btn-primary">Add to Diagram</button>
            </div>
        </div>
    </div>

    <!-- IP Allocation Modal -->
    <div id="ipAllocationModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Allocate IP Address</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>IP Pool</label>
                    <select id="ipPoolSelect">
                        <option value="">Select IP Pool...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Interface Name</label>
                    <input type="text" id="ipInterfaceName" placeholder="e.g., eth0, GigabitEthernet1/0/1">
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="ipIsPrimary">
                        Set as Primary IP
                    </label>
                </div>
                <div id="ipPoolInfo" style="display: none; padding: 12px; background: #f5f5f5; border-radius: 6px; margin-top: 12px;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 8px;">Pool Information:</div>
                    <div style="font-family: monospace; font-size: 13px;">
                        <div><strong>Network:</strong> <span id="poolNetwork"></span></div>
                        <div><strong>Gateway:</strong> <span id="poolGateway"></span></div>
                        <div><strong>VLAN:</strong> <span id="poolVlan"></span></div>
                        <div><strong>Next IP:</strong> <span id="poolNextIp" style="color: #0070f3; font-weight: 600;"></span></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel">Cancel</button>
                <button id="confirmAllocateIpBtn" class="btn btn-primary">Allocate IP</button>
            </div>
        </div>
    </div>

    <!-- Deployment Confirmation Modal -->
    <div id="deployModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>Deploy Diagram</h2>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p class="warning-message">
                    <svg class="warning-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 2L2 18h16L10 2zm0 14a1 1 0 100-2 1 1 0 000 2zm0-3V7"/>
                    </svg>
                    Deploying this diagram will mark it as the active configuration for this site. Any existing deployed diagram will be moved to draft status.
                </p>
                <div class="deploy-info">
                    <div class="info-row">
                        <span class="info-label">Diagram:</span>
                        <span id="deployDiagramName" class="info-value"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Site:</span>
                        <span id="deploySiteName" class="info-value"></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-cancel">Cancel</button>
                <button id="confirmDeployBtn" class="btn btn-success">Deploy</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
        <div class="loading-text">Loading...</div>
    </div>

    <!-- Dropdown Menu -->
    <div id="dropdownMenu" class="dropdown-menu" style="display: none;">
        <button id="renameDiagramBtn" class="dropdown-item">
            <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M11 2L14 5L5 14L2 14L2 11L11 2Z" stroke="currentColor" stroke-width="1.5"/>
            </svg>
            Rename
        </button>
        <button id="duplicateDiagramBtn" class="dropdown-item">
            <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                <rect x="5" y="5" width="9" height="9" stroke="currentColor" stroke-width="1.5"/>
                <path d="M11 3H3V11" stroke="currentColor" stroke-width="1.5"/>
            </svg>
            Duplicate
        </button>
        <button id="exportDiagramBtn" class="dropdown-item">
            <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M8 2V10M8 10L11 7M8 10L5 7M2 14H14" stroke="currentColor" stroke-width="1.5"/>
            </svg>
            Export
        </button>
        <div class="dropdown-divider"></div>
        <button id="deleteDiagramBtn" class="dropdown-item danger">
            <svg class="icon" width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M2 4H14M5 4V2H11V4M6 7V11M10 7V11M3 4L4 14H12L13 4" stroke="currentColor" stroke-width="1.5"/>
            </svg>
            Delete
        </button>
    </div>

    <script src="network-devices.js"></script>
    <script src="app.js"></script>
</body>
</html>